<div>
  <h1 class='text-4xl font-bold'>Setting</h1>
  <div class='grid grid-cols-2 gap-4 mt-4 ' data-controller="business-time-new">
    <section class='h-auto p-4 bg-white rounded'>
      <h2 class='text-3xl font-bold'>Business Time</h2>
      
      <% if @time_modules.exists? %>
        <button class='my-2 major-button' data-action="click->business-time-new#unfold">
          <i class="fa-solid fa-square-plus"></i>
          Create Time
        </button>
      <% end %>
      
      <div>
        <div class='fixed top-0 bottom-0 left-0 right-0 z-50 hidden bg-black bg-opacity-50 ' data-business-time-new-target='new'>
          <div class='absolute top-0 bottom-0 left-0 right-0 w-6/12 m-auto'>
            <div class='p-4 bg-white rounded '>
              <div class='relative'>
                <%= link_to '#', class: 'absolute rounded-full top-[-10px] right-[-8px]', data: {action: 'click->business-time-new#cancel'} do %>
                  <i class="text-2xl text-red-500 fa-solid fa-xmark hover:text-red-700"></i>
                <% end %>
              </div>
              <%= form_with model: @time_module, url: admin_restaurant_time_modules_path(@restaurant), data: {turbo: false} do |f| %>
                <div class='flex mb-4 text-lg'>
                  <%= f.label :title, class: 'border-y border-l rounded-l h-10 px-6 bg-major text-white py-1 border-major' %>
                  <%= f.text_field :title, class: 'w-10/12 rounded-r h-10 border-slate-300 mr-auto',
                    data: {
                      business_time_new_target: 'titleInput', 
                      action: 'input->business-time-new#getTitle'
                    }
                  %>
                </div>

                <template data-business-time-new-target='timeField'>
                  <%= f.fields_for :business_times, BusinessTime.new do |business_time_f| %>
                    <%= render 'nest_column', business_time_f: business_time_f %>
                  <% end %>
                </template>
                
                <div>
                  <%= f.fields_for :business_times do |business_time_f| %>
                    <%= render 'nest_column', business_time_f: business_time_f %>
                  <% end %>
                </div>

                <div class='flex justify-center'>
                  <%= link_to '#', data: {action: 'click->business-time-new#addColumn'} do %>
                    <i class="text-xl fa-solid fa-plus text-major hover:text-orange-600"></i>
                  <% end %>
                </div>

                <%= render partial: 'day_of_week_collection', locals: {f: f} %>

                <div class='flex gap-2'>
                  <%= f.submit class: 'disabled-button w-full', data: {business_time_new_target: 'submit'}, disabled: true %>
                </div>

              <% end %> 
            </div>

          </div>
        </div>
      </div>
      
      <div>
        <% if @time_modules.exists? %>
         <%= render partial: 'admin/time_modules/time_modules', collection: @time_modules, as: :time_module %>
        <% else %>
          <div class='p-4 mt-4 text-center border rounded'>
            <p class='text-lg text-gray-300 -4'>Click create to add a new business time</p>

            <button class='my-2 major-button' data-action="click->business-time-new#unfold">
              <i class="fa-solid fa-square-plus"></i>
              Create Time
            </button>
          </div>
        <% end %>
      </div>

    </section>
    
    <section class='h-auto p-4 bg-white rounded'>
      <h2 class='mb-3 text-3xl font-bold'>Off Day</h2>
      <div>
        <%= form_with model: @restaurant, url: off_day_setting_admin_restaurant_path(@restaurant) do |f| %>
          <div class='flex'>
            <input type="text" id="datepicker" class='w-full border-r-0 rounded-l border-slate-300' name='restaurant[off_day_list]' data-controller='flatpickr' data-restaurant=<%= @restaurant.id %>>
            <%= link_to setting_admin_restaurant_path(@restaurant), class: 'cancel-button rounded-none flex' do %>
              <i class="self-center fa-solid fa-xmark"></i>
            <% end %>
            <%= f.button nil, class: 'major-button rounded-l-none' do %>
              <i class="fa-solid fa-pen-to-square"></i>
            <% end %>
          </div>
        <% end %>
      </div>
      
      <div >
        <%= month_calendar events: @off_days, attribute: :day do |date, off_days| %>
          <div class=''>
            <%= date.day.to_s.rjust(2, '0') %>
          </div>
          <% off_days.each do |d| %>
            <%= link_to admin_off_day_path(d), data: { turbo_method: :delete }, class: 'flex border border-red-600 rounded-full px-1 justify-evenly items-center ' do %>
              <p class='mr-1 text-sm text-red-600 '>OFF</p>
              <i class="self-center px-1 text-white bg-red-500 rounded-full fa-solid fa-xmark"></i>
            <% end %>
          <% end %>
        <% end %>
      </div>
    </section>
  </div>
</div>
